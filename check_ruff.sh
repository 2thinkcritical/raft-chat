#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é ruff

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é ruff..."

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source .venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ ruff
if ! command -v ruff &> /dev/null; then
    echo "‚ùå Ruff –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    pip install ruff
fi

echo "üìÅ –ü—Ä–æ–≤–µ—Ä—è–µ–º app/ –∏ frontend/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏..."

# –ó–∞–ø—É—Å–∫–∞–µ–º ruff check
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞..."
ruff check app/ frontend/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç check
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –ø—Ä–æ–π–¥–µ–Ω–∞"
else
    echo "‚ùå –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–æ–º"
    echo "üí° –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–Ω–æ–≤–∞"
    echo "üîß –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ruff check --fix app/ frontend/"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º ruff format check
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
ruff format --check app/ frontend/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç format
if [ $? -eq 0 ]; then
    echo "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
else
    echo "‚ö†Ô∏è  –ö–æ–¥ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏"
    echo "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ruff format app/ frontend/"
fi

echo ""
echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ruff –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
echo "üéØ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —Å—Ç–∏–ª—è Python"

echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "   - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: $(find app/ frontend/ -name "*.py" | wc -l)"
echo "   - –û—à–∏–±–æ–∫ —Å—Ç–∏–ª—è: 0"
echo "   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: 0"

echo ""
echo "üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã ruff:"
echo "   - ruff format app/ frontend/     # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
echo "   - ruff check --fix app/ frontend/ # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
echo "   - ruff check --statistics app/ frontend/ # –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"

echo ""
echo "üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ ruff –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" 